# =============================================================================
# Add Collector to Existing Docker Compose
# =============================================================================
#
# If you already have a docker-compose.yaml, add this collector service
# and update your app's OTEL_EXPORTER_OTLP_ENDPOINT.
#
# Example integration:
#
# services:
#   your-existing-app:
#     # ... your existing config ...
#     environment:
#       - OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4318  # ADD THIS
#       - OTEL_TRACES_SAMPLER=always_on                           # ADD THIS
#     depends_on:
#       - otel-collector                                          # ADD THIS
#
#   # ADD THIS ENTIRE SERVICE:
#   otel-collector:
#     image: otel/opentelemetry-collector-contrib:0.118.0
#     volumes:
#       - ./otel-collector-config.yaml:/etc/otel-collector/config.yaml:ro
#     command: --config=/etc/otel-collector/config.yaml
#     environment:
#       - LAST9_OTLP_ENDPOINT=${LAST9_OTLP_ENDPOINT}
#       - LAST9_AUTH_HEADER=${LAST9_AUTH_HEADER}
#     # Only expose ports if apps outside Docker need to send traces
#     # ports:
#     #   - "4317:4317"
#     #   - "4318:4318"

# Full example service definition to copy:
services:
  otel-collector:
    image: otel/opentelemetry-collector-contrib:0.118.0
    container_name: otel-collector
    command: --config=/etc/otel-collector/config.yaml
    volumes:
      - ./otel-collector-config.yaml:/etc/otel-collector/config.yaml:ro
    environment:
      - LAST9_OTLP_ENDPOINT=${LAST9_OTLP_ENDPOINT}
      - LAST9_AUTH_HEADER=${LAST9_AUTH_HEADER}
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:13133/"]
      interval: 10s
      timeout: 5s
      retries: 3
    restart: unless-stopped
